<div class="tab-body">

<% prmtr = !params[:p] ?options[:parameter] : params[:p]%>

  <h2><%= Survey.title_for_parameter( prmtr.to_s) %></h2>
  <h3><%= Survey.question_for_parameter( prmtr.to_s )%></h3>


  
  <label for "age">Show age:</label>
	<%=
		@ageGroups = AgeGroup.find(:all).map {|e| [ e.description, e.id]}
		@ageGroups << ['Unknown', nil]
		@selected_ageGroup = @ageGroups[5][1]
		select('age',:description, @ageGroups, :selected=>5, :onclick => "requestData( prmtr, 'age');")
		
	%>
  
	<BR>&nbsp;<BR>&nbsp;<BR>
	<div id="ages-group" style="width: 650px; height: 300px;"></div>
	
	<BR>&nbsp;<BR>&nbsp;<BR>
	
	  <label >Show gender:</label>
	  <select id="gender" onclick="requestData( prmtr, gender); " >
	  <option disabled="disabled">Choose:</option>
		<option value="1" selected="selected">Male</option>
		<option value="2">Female</option>
		<option value="3" >Unknown</option>
	  </select>

	<div id="gender-group" style="width: 650px; height: 300px;"></div>

	<BR>&nbsp;<BR>&nbsp;<BR>

	<div id="all" style="width: 650px; height: 300px;"></div>

</div>

<script>

var chart_age;
$(document).ready(function() {
	
	chart_age = new Highcharts.Chart({
		chart: {
			renderTo: 'ages-group',
			defaultSeriesType: 'column',
			backgroundColor: '#0A0A0A'
		},
		title: {
			text: "Answers for Age Group "
		},
		xAxis: {
			categories: ['1-9', '10-99', '100-999', '1000-9999']
		},
		yAxis: {
			title: {
				text: 'Number of Responses'
			}
		},
		tooltip:{
			formatter: function(){
				return ' ' +this.y +' calculated ' + this.x+ ' stars';
			}
		},
		series: [{
			name: '11 and under',
			data: <%= Survey.new_report( prmtr.to_s  ,'age_group_id', 1).inspect%>
		
		},{
			name: '12 - 14',
			data: <%= Survey.new_report( prmtr.to_s  ,'age_group_id', 2).inspect%>
		},{
			name: '12-14',
			data: <%= Survey.report( prmtr.to_s  ,:age, 2).split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: '15-18',
			data: <%= Survey.report( prmtr.to_s  ,:age, 3).split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: '19-25',
			data: <%= Survey.report( prmtr.to_s  ,:age, 4).split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: '26-35',
			data: <%= Survey.report( prmtr.to_s  ,:age, 5).split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: '36-50',
			data: <%= Survey.report( prmtr.to_s  ,:age, 6).split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: '50+',
			data: <%= Survey.report( prmtr.to_s  ,:age, 7).split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: 'Unknown',
			data: <%= Survey.report( prmtr.to_s  ,:age, 0).split(',').collect{|e| e.to_i}.inspect %>
		}]
	});
	
});

var chart_gen;
$(document).ready(function() {
	
	chart_gen = new Highcharts.Chart({
		chart: {
			renderTo: 'gender-group',
			defaultSeriesType: 'column',
			backgroundColor: '#0A0A0A',
		},
		title: {
			text: "Answers for Gender"	
		},
		xAxis: {
			categories: ['1-9', '10-99', '100-999', '1000-9999']
		},
		yAxis: {
			title: {
				text: 'Number of Responses'
			}
		},
		tooltip:{
			formatter: function(){
				return ' ' +this.y +' calculated ' + this.x+ ' stars';
			}
		},
		series: [{
			name: 'Males',
			data: <%= Survey.report(prmtr.to_s ,:gender, "Male").split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: 'Females',
			data: <%= Survey.report(prmtr.to_s ,:gender, "Female").split(',').collect{|e| e.to_i}.inspect %>
		},{
			name: 'Unknown',
			data: <%= Survey.report(prmtr.to_s ,:gender, NIL).split(',').collect{|e| e.to_i}.inspect %>
		
		}]
	});
	
});

var chart_all;
$(document).ready(function() {
	chart_all = new Highcharts.Chart({
		chart: {
			renderTo: 'all',
			defaultSeriesType: 'column',
			backgroundColor: '#0A0A0A'
		},
		title: {
			text: 'All Users'
		},
		xAxis: {
			categories: ['1-9', '10-99', '100-999', '1000-9999']
		},
		yAxis: {
			title: {
				text: 'Number of Responses'
			}
		},
		tooltip:{
			formatter: function(){
				return ' ' +this.y +' calculated ' + this.x+ ' stars';
			}
		},
		series: [{
			name: 'all',
			data: <%= Survey.report(prmtr.to_s ,:all, '').split(',').collect{|e| e.to_i}.inspect %>
		}]
	});
	
});

function requestData(pm, whichDim){
	$.ajax({
		url:	'surveys/refresh?p=pm&aog=whichDim',
		success:  function(data){
			if (whichDim == 'age')
				chart_age.series[0] = data;
			else
				chart_gender.series[0] = data;
		},
		cache:	false
	
	});
}
	



</script>